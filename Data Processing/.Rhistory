beer_advocate <- read.csv("beeradvocate.com API 14th Dec 10-37.csv")
beer_head <- head(beer_advocate)
# remove duplicate columns with unimportant info
beer_advocate$bottomdark_links._text <- NULL
beer_advocate$bottomdark_links._source <- NULL
beer_advocate$pageUrl <- NULL
beer_advocate$image <- NULL
beer_advocate$bottomdark_content_numbers._source <- NULL
beer_advocate$bottomlight_number <- NULL
beer_advocate$link._source <- NULL
# change the column names
colnames(beer_advocate) <- c("address", "brewery_website", "beer_advocate_website", "number_of_reviews","beer_avg", "number_of_beers", "place_type", "brewery_rating", "brewery_name", "phone_number")
# get our missing values as NA
beer_advocate[beer_advocate == "-"] = NA
# clean up some of the columns and remove extra data
beer_advocate$address <- as.character(beer_advocate$address) # change into character data type
beer_advocate$address <- gsub(" official website", "", beer_advocate$address)
# extract the phone number from the address column
# http://stackoverflow.com/questions/21007607/extract-phone-number-regex
library(stringr)
beer_advocate$phone_number <- str_extract_all(beer_advocate$address, "\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?\\d{4}")
beer_advocate$phone_number[beer_advocate$phone_number == "character(0)"] = NA
# remove the phone number tag from the address field for geocoding
beer_advocate$address <- gsub(" phone: \\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?\\d{4}", "", beer_advocate$address)
# change the factor for average beer rating into a numeric
# http://stackoverflow.com/questions/3418128/how-to-convert-a-factor-to-an-integer-numeric-without-a-loss-of-information
beer_advocate$beer_avg <- as.numeric(levels(beer_advocate$beer_avg))[beer_advocate$beer_avg]
View(beer_advocate)
library(htmlwidgets)
library(leaflet)
install.packages("leaflet")
library(leaflet)
library(ggmap)
# This function geocodes a location (find latitude and longitude) using the Google Maps API
geo <- geocode(location = beer_advocate$address, output="latlon", source="google")
# add those coordinates to our dataset
beer_advocate$lon <- geo$lon
beer_advocate$lat <- geo$lat
View(beer_advocate)
beer_advocate <- read.csv("beeradvocate.com API 26th Sep 14_06.csv")
head(beer_advocate)
remove_1 <- grep("Results: ", beer_advocate$content_2, fixed = TRUE)
View(beer_advocate)
remove_2 <- grep("| 1-20 |", beer_advocate$content_2, fixed = TRUE)
remove_3 <- which(beer_advocate$content_2 == "Location")
remove_2 <- grep("prev |", beer_advocate$content_2, fixed = TRUE)
remove_1 <- grep("Results: ", beer_advocate$content_2, fixed = TRUE)
remove_2 <- grep("prev |", beer_advocate$content_2, fixed = TRUE)
remove_3 <- which(beer_advocate$content_2 == "Location")
remove <- c(remove_1, remove_2, remove3)
remove <- c(remove_1, remove_2, remove_3)
beer_advocate <- beer_advocate[-remove,]
View(beer_advocate)
row_nums <- seq(1, nrow(beer_advocate), by = 2)
library(dplyr)
library(purrr)
final_list <- list_along(row_nums)
tracker <- 1
i <- 1
cur_row <- row_nums[i]
beer_advocate[cur_row,"content2"]
cur_row
beer_advocate <- as.data.frame(beer_advocate)
beer_advocate[cur_row,"content_2"]
beer_advocate <- read.csv("beeradvocate.com API 26th Sep 14_06.csv", stringsAsFactors = FALSE)
remove_1 <- grep("Results: ", beer_advocate$content_2, fixed = TRUE)
remove_2 <- grep("prev |", beer_advocate$content_2, fixed = TRUE)
remove_3 <- which(beer_advocate$content_2 == "Location")
remove <- c(remove_1, remove_2, remove_3)
beer_advocate <- beer_advocate[-remove,]
beer_advocate <- as.data.frame(beer_advocate)
beer_advocate[cur_row,"content_2"]
beer_advocate[cur_row + 1, "links_3._text"]
test <- beer_advocate[cur_row + 1, "links_3._text"]
test
grep(";", test)
regexpr(";", test)
gregexpr(";", test)
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1]
substr(beer_advocate[cur_row + 1, "links_3._text"], 1,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1])
substr(beer_advocate[cur_row + 1, "links_3._text"], 1,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1] - 1)
substr(beer_advocate[cur_row + 1, "links_3._text"],
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1] + 2,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][2])
substr(beer_advocate[cur_row + 1, "links_3._text"],
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1] + 2,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][2] - 1)
data_frame(brewery_name = beer_advocate[cur_row,"content_2"],
brewery_rating = beer_advocate[cur_row,"content_3"],
num_reviews = beer_advocate[cur_row,"content_4"],
beer_avg = beer_advocate[cur_row,"content_5"],
num_beers = beer_advocate[cur_row,"content_6"],
address = beer_advocate[cur_row + 1, "content_2"],
type = beer_advocate[cur_row + 1, "content_5"],
city = substr(beer_advocate[cur_row + 1, "links_3._text"], 1,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1] - 1),
state = substr(beer_advocate[cur_row + 1, "links_3._text"],
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1] + 2,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][2] - 1))
cur_brew <- data_frame(brewery_name = beer_advocate[cur_row,"content_2"],
brewery_rating = beer_advocate[cur_row,"content_3"],
num_reviews = beer_advocate[cur_row,"content_4"],
beer_avg = beer_advocate[cur_row,"content_5"],
num_beers = beer_advocate[cur_row,"content_6"],
address = beer_advocate[cur_row + 1, "content_2"],
type = beer_advocate[cur_row + 1, "content_5"],
city = substr(beer_advocate[cur_row + 1, "links_3._text"], 1,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1] - 1),
state = substr(beer_advocate[cur_row + 1, "links_3._text"],
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1] + 2,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][2] - 1))
View(cur_brew)
final_list <- list_along(row_nums)
for(i in seq_along(row_nums)) {
cur_row <- row_nums[i]
cur_brew <- data_frame(brewery_name = beer_advocate[cur_row,"content_2"],
brewery_rating = beer_advocate[cur_row,"content_3"],
num_reviews = beer_advocate[cur_row,"content_4"],
beer_avg = beer_advocate[cur_row,"content_5"],
num_beers = beer_advocate[cur_row,"content_6"],
address = beer_advocate[cur_row + 1, "content_2"],
type = beer_advocate[cur_row + 1, "content_5"],
city = substr(beer_advocate[cur_row + 1, "links_3._text"], 1,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1] - 1),
state = substr(beer_advocate[cur_row + 1, "links_3._text"],
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][1] + 2,
gregexpr(";", beer_advocate[cur_row + 1, "links_3._text"])[[1]][2] - 1))
final_list[[i]] <- cur_brew
}
all_breweries <- bind_rows(final_list)
View(all_breweries)
all_breweries[all_breweries == "-"] <- NA
View(all_breweries)
all_breweries
library(stringr)
all_breweries$phone_number <- str_extract_all(all_breweries$address, "\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?\\d{4}")
beer_advocate$phone_number[beer_advocate$phone_number == "character(0)"] = NA
all_breweries$phone_number[all_breweries$phone_number == "character(0)"] = NA
View(all_breweries)
all_breweries$address <- gsub(" phone: \\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?\\d{4}", "", all_breweries$address)
all_breweries$address[1]
all_breweries$address <- gsub("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?\\d{4}", "", all_breweries$address)
all_breweries$address[1]
all_breweries$brewery_rating <- as.numeric(all_breweries$brewery_rating)
all_breweries$num_reviews <- as.numeric(all_breweries$num_reviews)
all_breweries$beer_avg <- as.numeric(all_breweries$beer_avg)
all_breweries$num_beers <- as.numeric(all_breweries$num_beers)
all_breweries
library(htmlwidgets)
library(leaflet)
library(ggmap)
geo <- geocode(location = all_breweries$address, output="latlon", source="google")
# add those coordinates to our dataset
all_breweries$lon <- geo$lon
all_breweries$lat <- geo$lat
geo <- geocode(location = all_breweries$address[1:2000], output="latlon", source="google")
View(geo)
which(is.na(geo$lon))
all_breweries$lon <- NA
all_breweries$lat <- NA
all_breweries$lon[1:2000] <- geo$lon
all_breweries$lat[1:2000] <- geo$lat
new_geo <- geocode(location = "6929 Heron Grove Ct Parsonsburg, Maryland, 21849-2155 United States", output = "latlon", source = "google")
all_breweries$lon[1347]
all_breweries$lon[1347] <- new_geo$lon
all_breweries$lat[1347] <- new_geo$lat
save(all_breweries, file = "all_breweries.RData")
range <- 2001:2400
library(ggmap)
load("all_breweries.RData")
range <- 2001:2400
geo <- geocode(location = all_breweries$address[range], output = "latlon", source = "google")
which(is.na(geo$lon))
new_geo <- geocode(location = "4051 S. LaFountain Kokomo, Indiana, 46902 United States", output = "latlon", source = "google")
geo$lon[286] <- new_geo$lon
geo$lat[286] <- new_geo$lat
which(is.na(geo$lon))
all_breweries$lon[range] <- geo$lon
all_breweries$lat[range] <- geo$lat
save(all_breweries, file = "all_breweries.RData")
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?\\d{4}", "", all_breweries$address)
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?BREW", "", all_breweries$address)
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]? BREW", "", all_breweries$address)
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?(BREW)", "", all_breweries$address)
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?", "", all_breweries$address)
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?\\d{4}", all_breweries$address)
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?BREW", all_breweries$address)
View(all_breweries)
all_breweries$address[559]
all_breweries$address <- gsub("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?BREW", "", all_breweries$address)
all_breweries$address[1347]
save(all_breweries, file = "all_breweries.RData")
View(all_breweries)
which(is.na(all_breweries$lon))
save(all_breweries, file = "all_breweries.RData")
all_breweries
all_breweries$address[559]
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?", all_breweries$address)
all_breweries$address[1]
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?.^", all_breweries$address)
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?.", all_breweries$address)
grep("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?.$", all_breweries$address)
library(ggmap)
load("all_breweries.RData")
range <- 2401:4000
geo <- geocode(location = all_breweries$address[range], output = "latlon", source = "google")
which(is.na(geo$lon))
new_geo <- geocode(location = "4150 Hunsaker, East Lansing, Michigan, 48823 United States", output = "latlon", source = "google")
geo$lon[114] <- new_geo$lon
geo$lat[114] <- new_geo$lat
new_geo <- geocode(location = "P.O. Box 739 Milwaukee, Wisconsin, 53201 United States", output = "latlon", source = "google")
geo$lon[543] <- new_geo$lon
geo$lat[543] <- new_geo$lat
which(is.na(geo$lon))
all_breweries$lon[range] <- geo$lon
all_breweries$lat[range] <- geo$lat
save(all_breweries, file = "all_breweries.RData")
all_breweries$address <- gsub("\\(?\\d{3}\\)?[.-]? *\\d{3}[.-]? *[.-]?BEER", "", all_breweries$address)
all_breweries$address[543]
range[543]
all_breweries$address[2943]
save(all_breweries, file = "all_breweries.RData")
which(is.na(all_breweries$lon))
library(ggmap)
load("all_breweries.RData")
range <- 4001:4900
geo <- geocode(location = all_breweries$address[range], output = "latlon", source = "google")
warnings()
which(is.na(geo$lon))
all_breweries$lon[range] <- geo$lon
all_breweries$lat[range] <- geo$lat
which(is.na(all_breweries$lon))
save(all_breweries, file = "all_breweries.RData")
View(all_breweries)
all_breweries %>%
mutate(city_state = paste0(city, ", ", state)) %>%
select(city_state) %>%
unique()
library(dplyr)
all_breweries %>%
mutate(city_state = paste0(city, ", ", state)) %>%
select(city_state) %>%
unique()
geocodeQueryCheck()
library(ggmap)
load("all_breweries.RData")
range <- 4877:5686
geocodeQueryCheck()
geo <- geocode(location = all_breweries$address[range], output = "latlon", source = "google")
warnings()
View(geo)
all_breweries$lon[range] <- geo$lon
all_breweries$lat[range] <- geo$lat
save(all_breweries, file = "all_breweries.RData")
which(is.na(all_breweries$lat))
library(ggmap)
load("all_breweries.RData")
which(is.na(all_breweries$lat))
range <- 4901:5686
geo <- geocode(location = all_breweries$address[range], output = "latlon", source = "google")
which(is.na(geo$lat))
all_breweries$lon[range] <- geo$lon
all_breweries$lat[range] <- geo$lat
save(all_breweries, file = "all_breweries.RData")
View(all_breweries)
all_breweries <- select(all_breweries, -phone_number)
library(dplyr)
all_breweries <- select(all_breweries, -phone_number)
save(all_breweries, file = "all_breweries.RData")
city_codes <- all_breweries %>%
mutate(city_state = paste0(city, ", ", state)) %>%
select(city_state) %>%
unique()
View(city_codes)
city_codes <- all_breweries %>%
mutate(city_state = paste0(city, ", ", state)) %>%
select(city_state) %>%
unique()
geo <- geocode(location = city_codes$city_state, output = "latlon", source = "google")
range <- 1:10
geo <- geocode(location = city_codes$city_state[range], output = "latlon", source = "google")
city_codes$lon[range] <- geo$lon
city_codes$lat[range] <- geo$lat
View(geo)
city_codes$lon <- NA
city_codes$lat <- NA
city_codes$lon[range] <- geo$lon
city_codes$lat[range] <- geo$lat
save(city_codes, "city_codes.RData")
save(city_codes, file = "city_codes.RData")
library(dplyr)
library(ggmap)
load("city_codes.RData")
range <- 11:100
geo <- geocode(location = city_codes$city_state[range], output = "latlon", source = "google")
city_codes$lon[range] <- geo$lon
city_codes$lat[range] <- geo$lat
save(city_codes, file = "city_codes.RData")
View(city_codes)
library(ggmap)
load("city_codes.RData")
range <- 101:1100
geo <- geocode(location = city_codes$city_state[range], output = "latlon", source = "google")
city_codes$lon[range] <- geo$lon
city_codes$lat[range] <- geo$lat
save(city_codes, file = "city_codes.RData")
which(is.na(city_codes$lon))
View(city_codes)
knitr::opts_chunk$set(echo = TRUE)
# install.packages("devtools")
# install.packages("knitr")
# devtools::install_github("hadley/ggplot2")
# devtools::install_github("hadley/dplyr")
library(ggplot2)
library(dplyr)
library(knitr)
load("all_breweries.RData")
all_breweries
brew_plot <- all_breweries %>%
filter(!is.na(brewery_rating), !is.na(num_beers))
brew_plot <- all_breweries %>%
filter(!is.na(brewery_rating), !is.na(num_beers))
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating))
View(brew_plot)
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating, color = type))
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating, shape = type))
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating, size = type))
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating), color = "blue")
library(maps)
states <- map_data("states")
install.packages("maps")
install.packages("maps")
library(maps)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
states <- map_data("states")
states <- map_data("state")
View(states)
unique(states$region)
unique(states$subregion)
brew_plot <- all_breweries %>%
filter(!is.na(brewery_rating), !is.na(num_beers),
state %in% c("Kansas", "Oklahoma", "Missouri", "Missouri", "Iowa",
"Nebraska", "Colorado"))
knitr::opts_chunk$set(echo = TRUE)
# install.packages("devtools")
# install.packages("knitr")
# install.packages("maps")
# devtools::install_github("hadley/ggplot2")
# devtools::install_github("hadley/dplyr")
library(ggplot2)
library(dplyr)
library(knitr)
library(maps)
load("all_breweries.RData")
all_breweries
brew_plot <- all_breweries %>%
filter(!is.na(brewery_rating), !is.na(num_beers),
state %in% c("Kansas", "Oklahoma", "Missouri", "Missouri", "Iowa",
"Nebraska", "Colorado"))
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating))
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating, color = type))
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating, shape = type))
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating, size = type))
ggplot(data = brew_plot) +
geom_point(mapping = aes(x = num_beers, y = brewery_rating), color = "blue")
unique(all_breweries$type)
all_breweries$type <- gsub(", Homebrew Store", "", all_breweries$type)
unique(all_breweries$type)
all_breweries$type <- gsub(", Store", "", all_breweries$type)
unique(all_breweries$type)
save(all_breweries, file = "all_breweries.RData")
library(ggmap)
load("city_codes.RData")
head(which(is.na(city_codes$lat)))
range <- 133:2633
range <- 133:2632
geo <- geocode(location = city_codes$city_state[range], output = "latlon", source = "google")
city_codes$lon[range] <- geo$lon
city_codes$lat[range] <- geo$lat
save(city_codes, file = "city_codes.RData")
View(city_codes)
which(is.na(city_codes$lat))
library(ggmap)
load("city_codes.RData")
range <- which(is.na(city_codes$lat))
geo <- geocode(location = city_codes$city_state[range], output = "latlon", source = "google")
city_codes$lon[range] <- geo$lon
city_codes$lat[range] <- geo$lat
save(city_codes, file = "city_codes.RData")
range <- which(is.na(city_codes$lat))
library(dplyr)
load("all_breweries.RData")
load("city_codes.RData")
all_breweries
city_codes
city_codes <- city_codes %>%
rename(city_lon = lon, city_lat = lat)
city_codes
city_codes
all_breweries <- all_breweries %>%
mutate(full_city = paste0(city, ", ", state)) %>%
left_join(city_codes, by = c("full_city" = "city_state"))
View(all_breweries)
save(all_breweries, file = "all_breweries.RData")
